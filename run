#!/usr/bin/env python3
"""Convenience launcher for installing deps and running the bots."""
import subprocess
import sys
from pathlib import Path

# Ensure pip is available
try:
    import pip  # noqa: F401
except ImportError:
    try:
        import ensurepip
        print("Bootstrapping pip...")
        ensurepip.bootstrap()
    except Exception as e:
        print(f"Failed to bootstrap pip: {e}")
        sys.exit(1)

BASE = Path(__file__).resolve().parent

ALPACA_REQS = BASE / "money" / "alpaca_bot" / "requirements.txt"
ROBINHOOD_REQS = BASE / "money" / "robinhood_bot" / "requirements.txt"
MASTER = BASE / "money" / "master.py"

commands = [
    [sys.executable, "-m", "pip", "install", "-r", str(ALPACA_REQS)],
    [sys.executable, "-m", "pip", "install", "-r", str(ROBINHOOD_REQS)],
    [sys.executable, str(MASTER)],
]

for cmd in commands:
    print(f"\U0001F4E6 Running: {' '.join(cmd)}")
    try:
        subprocess.check_call(cmd)
    except subprocess.CalledProcessError as e:
        print(f"Command failed: {' '.join(cmd)}\n{e}")
        sys.exit(e.returncode)
